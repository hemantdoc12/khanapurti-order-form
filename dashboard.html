<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Khana Purti Order Dashboard</title>
  <style>
    body { font-family: Roboto, sans-serif; background: #fff; margin: 0; padding: 20px; }
    header { background: #FF6200; color: white; padding: 10px; text-align: center; }
    table { width: 100%; max-width: 800px; margin: 20px auto; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    th { background: #f5f5f5; }
    select { padding: 5px; }
    #message { text-align: center; color: red; }
    @media (max-width: 600px) {
      table, th, td { font-size: 14px; }
      td { word-wrap: break-word; }
    }
  </style>
</head>
<body>
  <header>
    <h1>üçõ Khana Purti Order Dashboard</h1>
    <p>Live Kitchen Orders</p>
  </header>
  <table id="orderTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Items</th>
        <th>Total (‚Çπ)</th>
        <th>Delivery Time</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="orderList"></tbody>
  </table>
  <p id="message"></p>

  <!-- Firebase UMD SDK (v8.10.1) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  
  <script>
    // Firebase config (replace with your credentials)
    const firebaseConfig = {
      apiKey: "AIzaSyCnE592SJ9UGkKS-TB2C7_RwlYw-eG6gmU",
      authDomain: "khana-purti-orders.firebaseapp.com",
      databaseURL: "https://khana-purti-orders-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "khana-purti-orders",
      storageBucket: "khana-purti-orders.firebasestorage.app",
      messagingSenderId: "246464758996",
      appId: "1:246464758996:web:888ec1ef777d4d48396741",
      measurementId: "G-3ZJD9JSXY0"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Load menu to map IDs to names
    let menuMap = {};
    function loadMenu() {
      database.ref('menu/daily').once('value', snapshot => {
        const menu = snapshot.val() || [];
        menu.forEach(item => {
          menuMap[item.id] = item.name;
        });
        loadOrders();
      }, error => {
        document.getElementById('message').textContent = 'Error loading menu: ' + error.message;
        console.error('Menu load error:', error);
      });
    }

    // Load orders in real-time
    function loadOrders() {
      database.ref('orders').on('value', snapshot => {
        const orders = snapshot.val() || {};
        const orderList = document.getElementById('orderList');
        orderList.innerHTML = '';
        Object.entries(orders).reverse().forEach(([orderId, order]) => {
          const items = [];
          Object.keys(order).forEach(key => {
            if (menuMap[key] && order[key] > 0) {
              items.push(`${order[key]} ${menuMap[key]}`);
            }
          });
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${order.name}</td>
            <td>${items.join(', ') || 'None'}</td>
            <td>${order.total}</td>
            <td>${order.deliveryTime}</td>
            <td>
              <select onchange="updateStatus('${orderId}', this.value)">
                <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                <option value="Preparing" ${order.status === 'Preparing' ? 'selected' : ''}>Preparing</option>
                <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
              </select>
            </td>
          `;
          orderList.appendChild(row);
        });
        document.getElementById('message').textContent = Object.keys(orders).length ? '' : 'No orders yet.';
      }, error => {
        document.getElementById('message').textContent = 'Error loading orders: ' + error.message;
        console.error('Firebase error:', error);
      });
    }

    // Update order status
    function updateStatus(orderId, status) {
      database.ref(`orders/${orderId}/status`).set(status, error => {
        if (error) {
          document.getElementById('message').textContent = 'Error updating status: ' + error.message;
          console.error('Firebase error:', error);
        } else {
          console.log(`Order ${orderId} status updated to ${status}`);
        }
      });
    }

    // Load menu on start
    loadMenu();
  </script>
</body>
</html>
